{"tags":[{"name":"JavaScript","permalink":"http://lingyu.wang/tags/JavaScript/","url":"/async/tags/JavaScript.json","count":39},{"name":"NodeJs","permalink":"http://lingyu.wang/tags/NodeJs/","url":"/async/tags/NodeJs.json","count":14},{"name":"WebIM","permalink":"http://lingyu.wang/tags/WebIM/","url":"/async/tags/WebIM.json","count":9},{"name":"WebRTC","permalink":"http://lingyu.wang/tags/WebRTC/","url":"/async/tags/WebRTC.json","count":8},{"name":"WebSocket","permalink":"http://lingyu.wang/tags/WebSocket/","url":"/async/tags/WebSocket.json","count":8}],"categories":[{"name":"即时通信","permalink":"http://lingyu.wang/categories/即时通信/","url":"/async/categories/即时通信.json","count":9}],"url":"/async/posts/2014/03/17/SkyRTC-client-doc.json","date":1394985600000,"path":{"year":2014,"month":3,"day":17,"name":"SkyRTC-client-doc"},"subtitle":"使用SkyRTC搭建视频、音频聊天室","title":"开源WebRTC库——SkyRTC-client文档(客户端部分)","permalink":"http://lingyu.wang/2014/03/17/SkyRTC-client-doc/","content":"<p>忙了几天终于把SkyRTC库上传到NPM上了，并写了一份详细的使用文档，标明了基本的使用方法和类，修正了几个小bug，更多的bug还需要更多的测试，把文档发一下，具体项目见<a href=\"https://github.com/LingyuCoder/SkyRTC-client\" target=\"_blank\" rel=\"external\">我在Github上的SkyRTC-client项目</a></p>\n<a id=\"more\"></a>\n<h2 id=\"简介\">简介</h2><p>一个Node.js编写的WebRTC浏览器端库，为客户端库，需要配合服务器端库<a href=\"https://github.com/LingyuCoder/SkyRTC\" target=\"_blank\" rel=\"external\">SkyRTC</a>共同使用，用于搭建基于WebRTC和WebSocket技术的在线音频、视频聊天室</p>\n<h2 id=\"SkyRTC客户端库\">SkyRTC客户端库</h2><p><a href=\"https://github.com/LingyuCoder/SkyRTC\" target=\"_blank\" rel=\"external\">SkyRTC</a></p>\n<p>可使用npm进行安装：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm install skyrtc</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"SkyRTC实例\">SkyRTC实例</h2><p><a href=\"https://github.com/LingyuCoder/SkyRTC-demo\" target=\"_blank\" rel=\"external\">SkyRTC-demo</a>是一个基于SkyRTC搭建的多房间的在线音频、视频、文字聊天室，并能够共享文件</p>\n<h2 id=\"SkyRTC-client的使用\">SkyRTC-client的使用</h2><p>通过在HTML中引入JavaScript文件的方式引入：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">script</span> <span class=\"attribute\">type</span>=<span class=\"value\">\"text/javascript\"</span> <span class=\"attribute\">src</span>=<span class=\"value\">\"/SkyRTC-client.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"title\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>可通过如下方式监听SkyRTC-client的事件：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SkyRTC.on(<span class=\"string\">'someEvent'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">params</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//...</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>连接后台WebSocket服务器：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SkyRTC.connect(<span class=\"string\">\"ws:\"</span> + <span class=\"built_in\">window</span>.location.href.substring(<span class=\"built_in\">window</span>.location.protocol.length).split(<span class=\"string\">'#'</span>)[<span class=\"number\">0</span>], <span class=\"built_in\">window</span>.location.hash.slice(<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"方法\">方法</h2><ul>\n<li>connect</li>\n<li>on</li>\n<li>sendFile</li>\n<li>shareFile</li>\n<li>sendMessage</li>\n<li>broadcast</li>\n<li>sendFileAccept</li>\n<li>sendFileRefuse</li>\n<li>createStream</li>\n<li>attachStream</li>\n</ul>\n<h3 id=\"connect\">connect</h3><p>连接WebSocket后台服务器，建立信令交互的信道，并加入到一个房间之中</p>\n<p>参数：</p>\n<ul>\n<li>server——服务器地址</li>\n<li>room——房间名称</li>\n</ul>\n<p>返回值：<br>无</p>\n<h3 id=\"on\">on</h3><p>向SkyRTC-client相关事件绑定回调函数</p>\n<p>参数：</p>\n<ul>\n<li>eventName——事件名称</li>\n<li>callback——事件触发时的回调函数</li>\n</ul>\n<p>返回值：<br>无</p>\n<h3 id=\"sendFile\">sendFile</h3><p>向所在房间中的某个特定用户请求发送文件</p>\n<p>参数：</p>\n<ul>\n<li>dom——包含需要被发送的文件的input[type=’file’]的id或者dom对象</li>\n<li>socketId——接收文件的用户的id</li>\n</ul>\n<h3 id=\"shareFile\">shareFile</h3><p>向所在房间中的所有其他用户请求发送文件</p>\n<p>参数：</p>\n<ul>\n<li>dom——包含需要被发送的文件的input[type=’file’]的id或者dom对象</li>\n</ul>\n<p>返回值：<br>无</p>\n<h3 id=\"sendMessage\">sendMessage</h3><p>向所在房间内的某个特定用户发送消息</p>\n<p>参数：</p>\n<ul>\n<li>message——需要被发送的消息内容</li>\n<li>socketId——接收消息用户的id</li>\n</ul>\n<p>返回值：<br>无</p>\n<h3 id=\"broadcast\">broadcast</h3><p>向所在房间中的所有其他用户发送文字消息</p>\n<p>参数：</p>\n<ul>\n<li>msg——需要被发送的消息字符串</li>\n</ul>\n<p>返回值：<br>无</p>\n<h3 id=\"sendFileAccept\">sendFileAccept</h3><p>接收到文件发送请求后，同意接收文件</p>\n<p>参数：</p>\n<ul>\n<li>sendId——发送文件的id</li>\n</ul>\n<p>返回值：<br>无</p>\n<h3 id=\"sendFileRefuse\">sendFileRefuse</h3><p>接收到文件发送请求后，拒绝接收文件</p>\n<p>参数：</p>\n<ul>\n<li>sendId——发送文件的id</li>\n</ul>\n<p>返回值：<br>无</p>\n<h3 id=\"createStream\">createStream</h3><p>创建本地视频流</p>\n<p>参数：</p>\n<ul>\n<li>constraints——创建的视频流的约束对象</li>\n</ul>\n<p>返回值：<br>无</p>\n<h3 id=\"attachStream\">attachStream</h3><p>接收到远程视频流后，将视频流绑定到video标签上</p>\n<p>参数：</p>\n<ul>\n<li>stream——远程视频流对象</li>\n<li>domId——需要被绑定的video标签的id</li>\n</ul>\n<p>返回值：<br>无</p>\n<h2 id=\"原生事件\">原生事件</h2><h3 id=\"连接建立\">连接建立</h3><ul>\n<li>connected</li>\n<li>socket_opened</li>\n<li>socket_error</li>\n<li>socket_closed</li>\n<li>socket_receive_message</li>\n</ul>\n<h3 id=\"信令交换\">信令交换</h3><ul>\n<li>get_peers</li>\n<li>get_ice_candidate</li>\n<li>get_offer</li>\n<li>get_answer</li>\n<li>new_peer</li>\n<li>remove_peer</li>\n</ul>\n<h3 id=\"建立流\">建立流</h3><ul>\n<li>stream_created</li>\n<li>stream_created_error</li>\n</ul>\n<h3 id=\"PeerConnection相关事件\">PeerConnection相关事件</h3><ul>\n<li>pc_get_ice_candidate</li>\n<li>pc_opened</li>\n<li>pc_add_stream</li>\n<li>pc_add_data_channel</li>\n</ul>\n<h3 id=\"DataChannel相关事件\">DataChannel相关事件</h3><ul>\n<li>data_channel_create_error</li>\n<li>data_channel_opened</li>\n<li>data_channel_closed</li>\n<li>data_channel_message</li>\n<li>data_channel_error</li>\n</ul>\n<h3 id=\"文件发送相关\">文件发送相关</h3><ul>\n<li>send_file_error</li>\n<li>send_file</li>\n<li>send_file_refused</li>\n<li>send_file_accepted</li>\n<li>send_file_chunk</li>\n<li>sended_file</li>\n<li>receive_file_chunk</li>\n<li>receive_file</li>\n<li>receive_file_ask</li>\n<li>receive_file_error</li>\n</ul>\n<h2 id=\"连接建立事件详解\">连接建立事件详解</h2><h3 id=\"connected\">connected</h3><p>在于后台服务器成功创立WebSocket连接后触发</p>\n<p>参数：</p>\n<ul>\n<li>socket——与后台连接的WebSocket实例</li>\n</ul>\n<h3 id=\"socket_opened\">socket_opened</h3><p>WebSocket连接开启后触发</p>\n<p>参数：</p>\n<ul>\n<li>socket——与后台连接的WebSocket实例</li>\n</ul>\n<h3 id=\"socket_error\">socket_error</h3><p>WebSocket连接发生错误后触发</p>\n<p>参数：</p>\n<ul>\n<li>error——错误对象</li>\n<li>socket——与后台连接的WebSocket实例</li>\n</ul>\n<h3 id=\"socket_closed\">socket_closed</h3><p>WebSocket连接关闭后触发</p>\n<p>参数：</p>\n<ul>\n<li>socket——与后台连接的WebSocket实例</li>\n</ul>\n<h3 id=\"socket_receive_message\">socket_receive_message</h3><p>WebSocket连接接收到非自定义事件格式的信息时触发</p>\n<p>参数：</p>\n<ul>\n<li>socket——与后台连接的WebSocket实例</li>\n<li>jsonMsg——JSON格式的message</li>\n</ul>\n<h2 id=\"信令交换事件详解\">信令交换事件详解</h2><h3 id=\"get_peers\">get_peers</h3><p>在获取当前房间所有用户的id后调用</p>\n<p>参数：</p>\n<ul>\n<li>socketIds——房间内其他用户的id字符串列表</li>\n</ul>\n<h3 id=\"get_ice_candidate\">get_ice_candidate</h3><p>在获得了ICE Candidate信令后调用</p>\n<p>参数：</p>\n<ul>\n<li>candidate——ICE Candidate信令数据</li>\n</ul>\n<h3 id=\"get_offer\">get_offer</h3><p>在获得offer信令后调用</p>\n<p>参数：</p>\n<ul>\n<li>offer——offer信令数据<h3 id=\"get_answer\">get_answer</h3>在获得answer信令后调用</li>\n</ul>\n<p>参数：</p>\n<ul>\n<li>answer——answer信令数据</li>\n</ul>\n<h3 id=\"new_peer\">new_peer</h3><p>在有新用户加入后调用</p>\n<p>参数：</p>\n<ul>\n<li>socketId：新用户的id</li>\n</ul>\n<h3 id=\"remove_peer\">remove_peer</h3><p>有用户断开连接后调用</p>\n<p>参数：</p>\n<ul>\n<li>socketId：断开连接的用户的socket id</li>\n</ul>\n<h2 id=\"建立流-1\">建立流</h2><h3 id=\"stream_created\">stream_created</h3><p>成功建立本地视频流时触发</p>\n<p>参数：</p>\n<ul>\n<li>stream——本地视频流对象</li>\n</ul>\n<h3 id=\"stream_created_error\">stream_created_error</h3><p>建立本地视频流失败时触发</p>\n<p>参数：</p>\n<ul>\n<li>error——错误对象</li>\n</ul>\n<h2 id=\"PeerConnection相关事件-1\">PeerConnection相关事件</h2><h3 id=\"pc_opened\">pc_opened</h3><p>PeerConnection成功开启后触发</p>\n<p>参数：</p>\n<ul>\n<li>socketId——PeerConnection所连接用户的id</li>\n<li>pc——成功开启的PeerConnection实例</li>\n</ul>\n<h3 id=\"pc_get_ice_candidate\">pc_get_ice_candidate</h3><p>获得从ICE Candidate消息时触发</p>\n<p>参数：</p>\n<ul>\n<li>candidate——ICE Candidate信令内容</li>\n<li>socketId——PeerConnection所连接用户的id</li>\n<li>pc——获得信令PeerConnection实例</li>\n</ul>\n<h3 id=\"pc_add_stream\">pc_add_stream</h3><p>通过PeerConnection上接收到视频流后触发</p>\n<p>参数：</p>\n<ul>\n<li>stream——添加的流对象</li>\n<li>socketId——PeerConnection所连接用户的id</li>\n<li>pc——增加流的PeerConnection实例</li>\n</ul>\n<h3 id=\"pc_add_data_channel\">pc_add_data_channel</h3><p>通过PeerConnection上接收到data channel后触发</p>\n<p>参数：</p>\n<ul>\n<li>channel——添加的data channel</li>\n<li>socketId——PeerConnection所连接用户的id</li>\n<li>pc——增加data channel的PeerConnection实例</li>\n</ul>\n<h2 id=\"DataChannel相关事件-1\">DataChannel相关事件</h2><h3 id=\"data_channel_create_error\">data_channel_create_error</h3><p>data channel创建失败时触发</p>\n<p>参数：</p>\n<ul>\n<li>socketId——data channel所连接用户的id</li>\n<li>error——错误对象</li>\n</ul>\n<h3 id=\"data_channel_opened\">data_channel_opened</h3><p>data channel成功开启后触发</p>\n<p>参数：</p>\n<ul>\n<li>channel——开启的data channel实例</li>\n<li>socketId——data channel所连接用户的id</li>\n</ul>\n<h3 id=\"data_channel_closed\">data_channel_closed</h3><p>data channel关闭后触发</p>\n<p>参数：</p>\n<ul>\n<li>channel——被关闭的data channel实例</li>\n<li>socketId——data channel所连接用户的id</li>\n</ul>\n<h3 id=\"data_channel_message\">data_channel_message</h3><p>data channel上接收到数据且非文件信令类型时触发</p>\n<p>参数：</p>\n<ul>\n<li>channel——接收到数据的data channel实例</li>\n<li>socketId——data channel所属用户的id</li>\n<li>message——json格式的接收到的具体数据信息</li>\n</ul>\n<h3 id=\"data_channel_error\">data_channel_error</h3><p>data channel发生错误时触发</p>\n<p>参数：</p>\n<ul>\n<li>channel——发生错误的data channel实例</li>\n<li>socketId——data channel所连接用户的id</li>\n<li>error——错误对象</li>\n</ul>\n<h2 id=\"文件发送相关-1\">文件发送相关</h2><h3 id=\"send_file\">send_file</h3><p>读取需要发送的文件完毕，并请求对方接收时触发</p>\n<p>参数：</p>\n<ul>\n<li>sendId：发送的文件id</li>\n<li>socketId：接收者的id</li>\n<li>file：被发送的文件对象</li>\n</ul>\n<h3 id=\"send_file_error\">send_file_error</h3><p>发送方发送文件失败时触发</p>\n<p>参数：</p>\n<ul>\n<li>error——错误对象</li>\n<li>socketId——接收者的id</li>\n<li>sendId——发送失败的文件的id，为空则表示获取文件失败</li>\n<li>file——发送失败的文件对象，为空则表示获取文件失败</li>\n</ul>\n<h3 id=\"send_file_refused\">send_file_refused</h3><p>对方拒绝接收文件时触发</p>\n<p>参数：</p>\n<ul>\n<li>sendId——被拒绝接收的文件id</li>\n<li>socketId——接收者的id</li>\n<li>file——被拒绝接收的文件</li>\n</ul>\n<h3 id=\"send_file_accepted\">send_file_accepted</h3><p>对方同意接收文件时触发</p>\n<p>参数：</p>\n<ul>\n<li>sendId——被同意接收的文件id</li>\n<li>socketId——接收者的id</li>\n<li>file——被同意接收的文件</li>\n</ul>\n<h3 id=\"send_file_chunk\">send_file_chunk</h3><p>文件碎片发送后触发</p>\n<p>参数：</p>\n<ul>\n<li>sendId——文件碎片所属文件的id</li>\n<li>socketId——接收者的id</li>\n<li>percent——已发送的百分比</li>\n<li>file——被发送的文件对象</li>\n</ul>\n<h3 id=\"sended_file\">sended_file</h3><p>文件发送完成后触发</p>\n<p>参数：</p>\n<ul>\n<li>sendId——被发送的文件Id</li>\n<li>socketId——接收者的id</li>\n<li>file——被发送的文件对象<h3 id=\"receive_file_chunk\">receive_file_chunk</h3>接收到文件碎片时触发</li>\n</ul>\n<p>参数：</p>\n<ul>\n<li>sendId——接收的文件的Id</li>\n<li>socketId——发送者的id</li>\n<li>fileName——文件的名称</li>\n<li>percent——文件接收到的百分比</li>\n</ul>\n<h3 id=\"receive_file\">receive_file</h3><p>接收完整个文件后触发</p>\n<p>参数：</p>\n<ul>\n<li>sendId——接收的文件的Id</li>\n<li>socketId——发送者的id</li>\n<li>name——接收到的文件的名称</li>\n</ul>\n<h3 id=\"receive_file_ask\">receive_file_ask</h3><p>接收到文件发送请求后触发</p>\n<p>参数：</p>\n<ul>\n<li>sendId——被请求接收的文件的id</li>\n<li>socketId——发送者的id</li>\n<li>fileName——被请求接收的文件的名称</li>\n<li>fileSize——被请求接收的文件的大小</li>\n</ul>\n<h3 id=\"receive_file_error\">receive_file_error</h3><p>接收文件错误时触发</p>\n<p>参数：</p>\n<ul>\n<li>error——错误对象</li>\n<li>sendId——接收文件的id</li>\n<li>socketId——发送者的id</li>\n</ul>\n"}